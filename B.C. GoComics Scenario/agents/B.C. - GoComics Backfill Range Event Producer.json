{
  "language": "JavaScript",
  "code": "function get_dates_between(payload){\r\n  dateslist = []\r\n  \r\n  var start_date_year = payload['start_year']\r\n  var start_date_month = payload['start_month']\r\n  var start_date_day = payload['start_day']\r\n  var startDate = new Date(start_date_year, start_date_month, start_date_day)\r\n  \r\n  var end_date_year = payload['end_year']\r\n  var end_date_month = payload['end_month']\r\n  var end_date_day = payload['end_day']\r\n  var endDate = new Date(end_date_year, end_date_month, end_date_day)\r\n  \r\n  var startYear = startDate.getFullYear();\r\n  var endYear = endDate.getFullYear();\r\n  for(var indexyear=startYear;indexyear<=endYear;indexyear++){\r\n    \r\n    if (startYear == endYear) {\r\n      var startMonth = startDate.getMonth();\r\n      var endMonth = endDate.getMonth();\r\n    } else if (indexyear == startYear) {\r\n      var startMonth = startDate.getMonth();\r\n      var endMonth = 12\r\n    } else if (indexyear == endYear) {\r\n      var startMonth = 1\r\n      var endMonth = endDate.getMonth();\r\n    } else {\r\n      var startMonth = 1\r\n      var endMonth = 12\r\n    }\r\n    for(var indexmonth=startMonth;indexmonth<=endMonth;indexmonth++){\r\n      \r\n      indexDateEnd = new Date(indexyear, indexmonth, 0).getDate()\r\n      \r\n      if (startYear == endYear) {\r\n        if (startMonth == endMonth) {\r\n          var startDay = startDate.getDate();\r\n          var endDay = endDate.getDate();\r\n        } else if (indexmonth == startMonth) {\r\n          var startDay = startDate.getDate();\r\n          var endDay = indexDateEnd\r\n        } else if (indexmonth == endMonth) {\r\n          var startDay = 1\r\n          var endDay = endDate.getDate();\r\n        } else {\r\n          var startDay = 1\r\n          var endDay = indexDateEnd\r\n        }\r\n      } else if (indexyear == startYear) {\r\n        if (indexmonth == startMonth) {\r\n          var startDay = startDate.getDate();\r\n          var endDay = indexDateEnd\r\n        } else {\r\n          var startDay = 1\r\n          var endDay = indexDateEnd\r\n        }\r\n      } else if (indexyear == endYear) {\r\n        if (indexmonth == endMonth) {\r\n          var startDay = 1\r\n          var endDay = endDate.getDate();\r\n        } else {\r\n          var startDay = 1\r\n          var endDay = indexDateEnd\r\n        }\r\n      } else {\r\n        var startDay = 1\r\n        var endDay = indexDateEnd\r\n      }\r\n    \r\n      for(var indexDay=startDay;indexDay<=endDay;indexDay++){\r\n        dateslist.push((indexyear).toString() + \"/\" + (indexmonth).toString() + \"/\" + (indexDay).toString())\r\n      }\r\n    }\r\n  }\r\n  return dateslist;\r\n}\r\n\r\nfunction filterdates(dateslist, backfilled){\r\n  newdateslist = []\r\n  for (dateindex = 0; dateindex < dateslist.length; dateindex++) {\r\n    if(!(backfilled.includes(dateslist[dateindex]))){\r\n      newdateslist.push(dateslist[dateindex])\r\n    }\r\n  }\r\n  return newdateslist;\r\n}\r\n\r\n\r\nAgent.receive = function() {\r\n  var events = this.incomingEvents();\r\n  for(var i = 0; i < events.length; i++) {\r\n    \r\n    var start_date_year = events[i].payload['start_year']\r\n    var backfilled = this.memory('backfilled') || [];\r\n    \r\n    var dateslist = get_dates_between(events[i].payload)\r\n    var dateslist = filterdates(dateslist, backfilled)\r\n    dateslist.reverse()\r\n    var payloadcount = 0\r\n    for (dateindex = 0; dateindex < dateslist.length; dateindex++) {\r\n      var payload = events[i].payload\r\n      if(payloadcount <= 1){\r\n        payloadcount += 1\r\n        payload['urlpath'] = dateslist[dateindex]\r\n        backfilled.push(dateslist[dateindex])\r\n        this.memory('backfilled', backfilled);\r\n        payload['backfill_complete'] = 0\r\n        this.createEvent(payload);\r\n      }\r\n    }\r\n    if (!(payloadcount >= 1)){this.createEvent({'backfill_complete':1})}\r\n  }\r\n}",
  "expected_receive_period_in_days": "2",
  "expected_update_period_in_days": "2"
}
